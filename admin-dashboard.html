<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†åå° - æ¸¯åŸ é›¨æ—ç•™è¨€ç®¡ç†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="min-h-screen p-4">
    <div class="max-w-6xl mx-auto">
        <!-- æ ‡é¢˜ -->
        <div class="text-center mb-8 pt-8">
            <h1 class="text-4xl font-bold text-white mb-4">ğŸ”§ ç®¡ç†åå°</h1>
            <p class="text-white/90 text-lg">æ¸¯åŸ é›¨æ—å®¢æˆ·ç•™è¨€ç®¡ç†ç³»ç»Ÿ</p>
        </div>

        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
            <div class="glass-effect rounded-xl p-6 text-center">
                <div class="text-3xl font-bold text-blue-600" id="totalCount">0</div>
                <div class="text-gray-600 font-medium">æ€»ç•™è¨€æ•°</div>
            </div>
            <div class="glass-effect rounded-xl p-6 text-center">
                <div class="text-3xl font-bold text-green-600" id="todayCount">0</div>
                <div class="text-gray-600 font-medium">ä»Šæ—¥ç•™è¨€</div>
            </div>
            <div class="glass-effect rounded-xl p-6 text-center">
                <div class="text-3xl font-bold text-purple-600" id="weekCount">0</div>
                <div class="text-gray-600 font-medium">æœ¬å‘¨ç•™è¨€</div>
            </div>
            <div class="glass-effect rounded-xl p-6 text-center">
                <div class="text-3xl font-bold text-orange-600" id="monthCount">0</div>
                <div class="text-gray-600 font-medium">æœ¬æœˆç•™è¨€</div>
            </div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="glass-effect rounded-xl shadow-xl p-6 mb-6">
            <div class="flex flex-wrap gap-4">
                <button onclick="refreshData()"
                        class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors font-medium">
                    ğŸ”„ åˆ·æ–°æ•°æ®
                </button>
                <button onclick="exportAllData()"
                        class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition-colors font-medium">
                    ğŸ“¥ å¯¼å‡ºå…¨éƒ¨æ•°æ®
                </button>
                <button onclick="exportTodayData()"
                        class="bg-purple-500 text-white px-6 py-3 rounded-lg hover:bg-purple-600 transition-colors font-medium">
                    ğŸ“… å¯¼å‡ºä»Šæ—¥æ•°æ®
                </button>
                <button onclick="clearAllData()"
                        class="bg-red-500 text-white px-6 py-3 rounded-lg hover:bg-red-600 transition-colors font-medium">
                    ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ•°æ®
                </button>
            </div>
        </div>

        <!-- æ•°æ®åˆ—è¡¨ -->
        <div class="glass-effect rounded-xl shadow-xl p-6">
            <h3 class="text-xl font-bold text-gray-800 mb-6">ğŸ“‹ å®¢æˆ·ç•™è¨€è®°å½•</h3>
            <div id="recordsList" class="space-y-4 max-h-96 overflow-y-auto">
                <p class="text-gray-500 text-center py-8">æ­£åœ¨åŠ è½½æ•°æ®...</p>
            </div>
        </div>

        <!-- å¿«é€Ÿè®¿é—®é“¾æ¥ -->
        <div class="glass-effect rounded-xl shadow-xl p-6 mt-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ”— å¿«é€Ÿè®¿é—®</h3>
            <div class="flex flex-wrap gap-4">
                <a href="customer-contact-form.html" target="_blank"
                   class="bg-indigo-500 text-white px-4 py-2 rounded-lg hover:bg-indigo-600 transition-colors">
                    ğŸ“ å®¢æˆ·ç•™è¨€è¡¨å•
                </a>
                <a href="http://localhost:3002" target="_blank"
                   class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors">
                    ğŸŒ å®˜æ–¹ç½‘ç«™
                </a>
            </div>
        </div>
    </div>

    <script>
        // è·å–æ‰€æœ‰ç•™è¨€æ•°æ®
        function getAllSubmissions() {
            return JSON.parse(localStorage.getItem('contactSubmissions') || '[]');
        }

        // è®¡ç®—ç»Ÿè®¡æ•°æ®
        function calculateStats() {
            const submissions = getAllSubmissions();
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            const monthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);

            const todayCount = submissions.filter(item => {
                const itemDate = new Date(item.timestamp.replace(/\//g, '-'));
                return itemDate >= today;
            }).length;

            const weekCount = submissions.filter(item => {
                const itemDate = new Date(item.timestamp.replace(/\//g, '-'));
                return itemDate >= weekAgo;
            }).length;

            const monthCount = submissions.filter(item => {
                const itemDate = new Date(item.timestamp.replace(/\//g, '-'));
                return itemDate >= monthAgo;
            }).length;

            document.getElementById('totalCount').textContent = submissions.length;
            document.getElementById('todayCount').textContent = todayCount;
            document.getElementById('weekCount').textContent = weekCount;
            document.getElementById('monthCount').textContent = monthCount;

            return {
                total: submissions.length,
                today: todayCount,
                week: weekCount,
                month: monthCount
            };
        }

        // æ˜¾ç¤ºç•™è¨€è®°å½•
        function displayRecords() {
            const submissions = getAllSubmissions();
            const recordsList = document.getElementById('recordsList');

            if (submissions.length === 0) {
                recordsList.innerHTML = '<p class="text-gray-500 text-center py-8">æš‚æ— ç•™è¨€è®°å½•</p>';
                return;
            }

            // æŒ‰æ—¶é—´å€’åºæ˜¾ç¤ºï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰
            const sortedSubmissions = submissions.slice().reverse();

            let html = '';
            sortedSubmissions.forEach((item, index) => {
                const actualIndex = submissions.length - index;
                const statusBadge = item.status === 'pending'
                    ? '<span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full">å¾…å¤„ç†</span>'
                    : '<span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">å·²å¤„ç†</span>';

                html += `
                    <div class="bg-white rounded-lg p-4 border border-gray-200 hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex items-center gap-3">
                                <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">#${actualIndex}</span>
                                <span class="font-semibold text-gray-800">${item.name}</span>
                                <span class="text-gray-600">${item.phone}</span>
                            </div>
                            <div class="flex items-center gap-2">
                                ${statusBadge}
                                <button onclick="deleteRecord(${item.id})"
                                        class="text-red-500 hover:text-red-700 transition-colors"
                                        title="åˆ é™¤è®°å½•">
                                    ğŸ—‘ï¸
                                </button>
                            </div>
                        </div>
                        <div class="text-sm text-gray-500 mb-2">
                            ğŸ•’ ${item.timestamp}
                        </div>
                        <div class="text-gray-700 bg-gray-50 p-3 rounded">
                            ${item.message}
                        </div>
                    </div>
                `;
            });

            recordsList.innerHTML = html;
        }

        // åˆ é™¤å•æ¡è®°å½•
        function deleteRecord(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                const submissions = getAllSubmissions();
                const filtered = submissions.filter(item => item.id !== id);
                localStorage.setItem('contactSubmissions', JSON.stringify(filtered));
                refreshData();
            }
        }

        // åˆ·æ–°æ•°æ®
        function refreshData() {
            calculateStats();
            displayRecords();
        }

        // ä¸‹è½½æ–‡ä»¶
        function downloadFile(content, filename, mimeType = 'application/json') {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // å¯¼å‡ºå…¨éƒ¨æ•°æ®
        function exportAllData() {
            const submissions = getAllSubmissions();
            if (submissions.length === 0) {
                alert('æš‚æ— æ•°æ®å¯å¯¼å‡º');
                return;
            }

            const exportData = {
                exportTime: new Date().toISOString(),
                exportType: 'all',
                totalCount: submissions.length,
                statistics: calculateStats(),
                submissions: submissions
            };

            const filename = `æ¸¯åŸ é›¨æ—_å…¨éƒ¨å®¢æˆ·ç•™è¨€_${new Date().toISOString().split('T')[0]}.json`;
            downloadFile(JSON.stringify(exportData, null, 2), filename);

            // åŒæ—¶å¯¼å‡ºå¯è¯»çš„æ–‡æœ¬æ ¼å¼
            let textContent = `æ¸¯åŸ é›¨æ—å®¢æˆ·ç•™è¨€æ•°æ®å¯¼å‡º
å¯¼å‡ºæ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}
æ€»ç•™è¨€æ•°ï¼š${submissions.length}

`;
            submissions.slice().reverse().forEach((item, index) => {
                const actualIndex = submissions.length - index;
                textContent += `
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
è®°å½• #${actualIndex}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å§“åï¼š${item.name}
æ‰‹æœºï¼š${item.phone}
æ—¶é—´ï¼š${item.timestamp}
çŠ¶æ€ï¼š${item.status}

ç•™è¨€å†…å®¹ï¼š
${item.message}

`;
            });

            const txtFilename = `æ¸¯åŸ é›¨æ—_å…¨éƒ¨å®¢æˆ·ç•™è¨€_${new Date().toISOString().split('T')[0]}.txt`;
            downloadFile(textContent, txtFilename, 'text/plain');

            alert(`âœ… å·²å¯¼å‡º ${submissions.length} æ¡ç•™è¨€è®°å½•\næ–‡ä»¶æ ¼å¼ï¼šJSON å’Œ TXT`);
        }

        // å¯¼å‡ºä»Šæ—¥æ•°æ®
        function exportTodayData() {
            const submissions = getAllSubmissions();
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];

            const todaySubmissions = submissions.filter(item => {
                const itemDate = new Date(item.timestamp.replace(/\//g, '-'));
                return itemDate.toISOString().split('T')[0] === todayStr;
            });

            if (todaySubmissions.length === 0) {
                alert('ä»Šæ—¥æš‚æ— ç•™è¨€æ•°æ®');
                return;
            }

            const exportData = {
                exportTime: new Date().toISOString(),
                exportType: 'today',
                date: todayStr,
                totalCount: todaySubmissions.length,
                submissions: todaySubmissions
            };

            const filename = `æ¸¯åŸ é›¨æ—_ä»Šæ—¥å®¢æˆ·ç•™è¨€_${todayStr}.json`;
            downloadFile(JSON.stringify(exportData, null, 2), filename);

            alert(`âœ… å·²å¯¼å‡ºä»Šæ—¥ ${todaySubmissions.length} æ¡ç•™è¨€è®°å½•`);
        }

        // æ¸…ç©ºæ‰€æœ‰æ•°æ®
        function clearAllData() {
            const count = getAllSubmissions().length;
            if (count === 0) {
                alert('æš‚æ— æ•°æ®éœ€è¦æ¸…ç©º');
                return;
            }

            if (confirm(`ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ ${count} æ¡ç•™è¨€è®°å½•å—ï¼Ÿ\næ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) {
                localStorage.removeItem('contactSubmissions');
                refreshData();
                alert('âœ… æ‰€æœ‰æ•°æ®å·²æ¸…ç©º');
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', function() {
            refreshData();

            // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°æ•°æ®
            setInterval(refreshData, 30000);
        });
    </script>
</body>
</html>